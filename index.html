<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Termo de Entrega — Via Única (A4 v17 • no/na automático + Obs)</title>
  <style>
    @page { size: A4; margin: 15mm; }
    :root{ --ink:#111; --muted:#444; --hair:#00000026; --tag:#0b2a4a; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{font-family: "Times New Roman", Times, serif; color:var(--ink); background:#fff}

    .outer{min-height:100%; display:flex; align-items:flex-start; justify-content:center;}
    .sheet{width: 100%; max-width: 720px; margin: 18px auto; padding: 4px 8px 8px;}

    /* Cabeçalho minimalista: logo + título (sem quebra) + meta sutil logo abaixo */
    header{display:grid; grid-template-columns:auto 1fr auto; grid-auto-rows:auto; align-items:center; gap:16px; padding:6px 0 8px; border-bottom:1px solid var(--hair)}
    .logo{height:64px; display:flex; align-items:center}
    .logo img{max-height:64px; width:auto; object-fit:contain; display:block}
    .title{text-align:center}
    h1{font-size:26px; margin:0; text-transform:uppercase; letter-spacing:.4px; white-space:nowrap}
    /* meta ocupa a linha inteira logo abaixo do conjunto */
    .meta{grid-column:1/-1; margin-top:4px; font-size:12px; text-align:center; line-height:1.4; color:var(--muted)}
    .meta .code{font-variant-numeric: tabular-nums}

    /* Faixa de destaque da OBRA */
    .obra-highlight{display:flex; align-items:center; gap:8px; padding:10px 0;} 
    .obra-label{font-size:12px; letter-spacing:.06em; text-transform:uppercase; color:var(--muted)}
    .obra-tag{border:1px solid var(--hair); padding:6px 10px; font-size:16px; font-weight:700; letter-spacing:.02em;}

    .form{margin-top:6px; border-bottom:1px dashed var(--hair); padding-bottom:10px} 
    .row{display:flex; gap:10px; margin:6px 0}
    .row .field{flex:1}
    input, textarea{width:100%; border:1px solid var(--hair); padding:8px 10px; font-size:14px; font-family:inherit; outline:none}
    input:focus, textarea:focus{border-color:#00000055}
    textarea{min-height:68px; resize:vertical}

    .decl{margin-top:14px; line-height:1.75; font-size:18px; text-align:justify}
    .decl strong{font-weight:bold}

    .obs-out{margin-top:10px; font-size:14px; color:var(--muted);}
    .obs-out b{color:var(--ink)}

    .signatures{margin-top:18px}
    .sig-grid{display:grid; grid-template-columns:1fr 1fr; gap:28px; page-break-inside:avoid}
    .sig-title{font-weight:bold; text-transform:uppercase; font-size:13px; margin:0 0 10px 0; text-align:center; color:var(--muted)}
    .sig-line{margin-top:18px}
    .sig-line .line{border-bottom:1px solid #000; height:26px}
    .sig-line .below{font-size:12px; text-align:center; margin-top:3px; color:var(--muted)}
    .stamp{border:1px dashed var(--hair); height:70px; margin-top:14px; display:flex; align-items:center; justify-content:center; font-size:11px; text-transform:uppercase; color:var(--muted)}

    footer{display:flex; justify-content:space-between; align-items:center; margin-top:16px; padding-top:8px; border-top:1px solid var(--hair); font-size:12px; color:var(--muted)}

    .actions{margin:12px auto 0; display:flex; gap:8px; justify-content:center}
    button{font-family:inherit; border:1px solid #000; background:#fff; padding:8px 12px; cursor:pointer}

    .print-only{display:none}
    @media print{
      .actions{display:none}
      .sheet{margin:0; padding:0}
      input, textarea{border-color:transparent}
      .print-only{display:inline}
      .sig-grid{break-inside:avoid}
      /* Só no PDF: esconder seções entre o título e o texto */
      .obra-highlight, .form{display:none !important}
      /* Texto maior e mais confortável para A4 */
      .decl{font-size:19px; line-height:1.9}
    }
  </style>
</head>
<body>
  <div class="outer">
    <section class="sheet">
      <header>
        <div class="logo"><img id="logo" alt="System Engenharia" src="./assets/logo-system.jpg" /></div>
        <div class="title">
          <h1>Termo de Entrega</h1>
        </div>
        <div><!-- espaço para manter a grade de 3 colunas equilibrada --></div>
        <div class="meta">
          <div class="code"><span id="codigoDoc"></span> • Nº <span id="numTermo"></span></div>
          <div><span id="dataHoje"></span></div>
        </div>
      </header>

      <!-- OBRA em destaque para PDF -->
      <div class="obra-highlight">
        <div class="obra-label">Obra</div>
        <div class="obra-tag" id="obraOut">—</div>
      </div>

      <div class="form">
        <div class="row">
          <div class="field">
            <input id="obra" placeholder="Empreendimento / Obra — Ex.: Atlântico Golf" spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" />
          </div>
          <div class="field" style="max-width:220px">
            <input id="bloco" placeholder="Bloco / Torre / Local — Ex.: Torre B / Subsolo / Reservatório" spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" />
          </div>
          <div class="field" style="max-width:220px">
            <input id="area" placeholder="Área / Unidade / Ambiente (opcional) — Ex.: Casa de Máquinas / Apto 101" spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <textarea id="escopo" placeholder="Serviços entregues (descrição breve) — Ex.: redes de recalque de água potável para os blocos 1, 2 e 3" spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off"></textarea>
          </div>
        </div>
        <div class="row">
          <div class="field">
            <input id="obs" placeholder="Observações — Ex.: Conforme projeto e memorial" spellcheck="false" autocapitalize="off" autocomplete="off" autocorrect="off" />
          </div>
        </div>
      </div>

      <div class="decl" id="declaracao"></div>
      <div class="obs-out" id="obsOut" hidden></div>

      <section class="signatures">
        <div class="sig-grid">
          <div>
            <div class="sig-title">Contratante</div>
            <div class="sig-line"><div class="line"></div><div class="below">ASSINATURA</div></div>
            <div class="sig-line"><div class="line"></div><div class="below">NOME LEGÍVEL</div></div>
            <div class="sig-line"><div class="line"></div><div class="below">CPF / RG</div></div>
            <div class="sig-line"><div class="line"></div><div class="below">CARGO / SETOR</div></div>
            <div class="sig-line"><div class="line"></div><div class="below">DATA</div></div>
            <div class="stamp">CARIMBO</div>
          </div>
          <div>
            <div class="sig-title">Contratada</div>
            <div class="sig-line"><div class="line"></div><div class="below">ASSINATURA</div></div>
            <div class="sig-line"><div class="line"></div><div class="below">NOME LEGÍVEL</div></div>
            <div class="sig-line"><div class="line"></div><div class="below">CPF / RG</div></div>
            <div class="sig-line"><div class="line"></div><div class="below">CARGO</div></div>
            <div class="sig-line"><div class="line"></div><div class="below">DATA</div></div>
            <div class="stamp">CARIMBO</div>
          </div>
        </div>
      </section>

      <footer>
        <div>Gerado em <span id="gerado"></span></div>
        <div class="print-only">(Via única — imprima 2 cópias)</div>
      </footer>

      <div class="actions">
        <button onclick="window.print()">Imprimir / Salvar PDF</button>
        <button onclick="limpar()">Limpar</button>
      </div>
    </section>
  </div>

  <script>
    (function(){
      const pad = n=>String(n).padStart(2,'0');
      const now = new Date();
      const fmtLong = new Intl.DateTimeFormat('pt-BR',{dateStyle:'full'});
      const fmtShort = new Intl.DateTimeFormat('pt-BR',{dateStyle:'medium', timeStyle:'short'});
      const CODIGO = 'TERMO';
      const numero = `${CODIGO}-${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}-${pad(now.getHours())}${pad(now.getMinutes())}`;

      document.getElementById('dataHoje').textContent = fmtLong.format(now);
      document.getElementById('numTermo').textContent = numero;
      document.getElementById('codigoDoc').textContent = `Código: ${CODIGO}`;
      document.getElementById('gerado').textContent = fmtShort.format(now);

      function montar(){
        const obra  = document.getElementById('obra').value.trim();
        const bloco = document.getElementById('bloco').value.trim();
        const area  = document.getElementById('area').value.trim();
        const esc   = document.getElementById('escopo').value.trim();
        const obs   = document.getElementById('obs').value.trim();

        // Atualiza destaque Obra
        document.getElementById('obraOut').textContent = obra || '—';

        // ===== Preposição no/na por termo =====
        const femHints = [
          'academia','portaria','cobertura','recepção','recepcao','casa','torre',
          'área','area','laje','garagem','prumada','rede','sala','central',
          'elevatória','elevatoria','cisterna','bancada','escada','copa','cozinha'
        ];
        const femSuffix = /(a|á|ção|são|xão|gem|dade|tude|agem|ice|ose|ese|ura|ite\b)$/i;
        const startsWithPrep = /^(no|na|em)\s/i;

        const withPrep = (term) => {
          const t = term.trim();
          if (!t) return '';
          if (startsWithPrep.test(t)) return t;            // usuário já pôs a preposição
          const base = t.toLowerCase();
          const isFeminine = femHints.some(h => base.startsWith(h)) || femSuffix.test(base);
          return (isFeminine ? 'na ' : 'no ') + t;
        };

        const partes = [];
        if (bloco) partes.push(bloco);
        if (area)  partes.push(area);

        // Aplica preposição em cada parte: ex. "na Academia, no Subsolo"
        const locParts = partes.map(withPrep).filter(Boolean);
        const localTxt = locParts.length ? ` ${locParts.join(', ')}` : '';

        const obraTxt = obra ? ` no empreendimento <strong>${obra}</strong>` : '';
        const escTxt  = esc  ? `<strong>${esc}</strong>` : 'escopo descrito';

        const frase = `Declaro que, na data de <strong>${fmtLong.format(new Date())}</strong>, os serviços de ${escTxt}${localTxt}${obraTxt} foram entregues conforme descrito.`;
        document.getElementById('declaracao').innerHTML = frase;

        // Observações (apenas se houver)
        const obsOut = document.getElementById('obsOut');
        if (obs){
          obsOut.innerHTML = `<b>Observações:</b> ${obs}`;
          obsOut.hidden = false;
        } else {
          obsOut.hidden = true;
          obsOut.textContent = '';
        }
      }

      ['obra','bloco','area','escopo','obs'].forEach(id=>{
        const el = document.getElementById(id);
        el.addEventListener('input', montar, {passive:true});
      });

      montar();
    })();

    function limpar(){
      ['obra','bloco','area','escopo','obs'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value=''; });
      const fmtLong = new Intl.DateTimeFormat('pt-BR',{dateStyle:'full'});
      document.getElementById('obraOut').textContent = '—';
      document.getElementById('declaracao').innerHTML = `Declaro que, na data de <strong>${fmtLong.format(new Date())}</strong>, os serviços descritos acima foram entregues.`;
      const obsOut = document.getElementById('obsOut');
      obsOut.hidden = true; obsOut.textContent = '';
    }
  </script>
</body>
</html>

